{% extends "layout.html" %}

{% block content %}
  <link rel="stylesheet" href="{{ url_for('static', filename='overview.css') }}">

  <div class="overviewSlider">
    <h1 class="overviewHeader">Dismissals</h1>
    <p class="subtitle" style="text-align: center; font-size: 1.2rem; color: #555; margin-bottom: 30px;">
      There are 10 ways a player can get out. Click each one to learn more.
    </p>

    <div class="grid nav-buttons">
      {% for dismissal in dismissals %}
        <button class="dismissal-btn" disabled data-dismissal="{{ dismissal }}"
                data-dismissal-index="{{ loop.index }}">
          {{ dismissal }}
        </button>
      {% endfor %}
    </div>
    <div style="text-align: center; margin-top: 30px;">
      <button id="clear-cookies-btn" class="debug-btn" style="background-color: #e74c3c; color: white;">
        Debug: Clear Dismissal Cookies
      </button>
    </div>
  </div>

  <script>
    function setCookie(name, value, days = 365) {
      const expires = new Date(Date.now() + days * 864e5).toUTCString();
      document.cookie = `${encodeURIComponent(name)}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
    }

    function getCookie(name) {
      return document.cookie
        .split('; ')
        .find(row => row.startsWith(encodeURIComponent(name) + '='))
        ?.split('=')[1];
    }

    document.querySelectorAll('.dismissal-btn').forEach(btn => {
      const name = btn.dataset.dismissal;
      const index = btn.getAttribute("data-dismissal-index");
      const visited = getCookie(name);

      if (visited === "true" || index === "1") {
        btn.removeAttribute('disabled');
      }

      btn.addEventListener('click', () => {
        setCookie(name, true);
        window.location.href = "/dismissal/" + index;
      });
    });

    function deleteCookie(name) {
      document.cookie = `${encodeURIComponent(name)}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
    }
    const clearBtn = document.getElementById('clear-cookies-btn');
    if (clearBtn) {
      clearBtn.addEventListener('click', () => {
        document.querySelectorAll('.dismissal-btn').forEach(btn => {
          const name = btn.dataset.dismissal;
          const index = btn.getAttribute("data-dismissal-index");

          if (index !== "1") {
            deleteCookie(name);
            btn.setAttribute('disabled', true);
          }
        });

        alert('Dismissal-related cookies cleared (except first)!');
      });
    }
  </script>
{% endblock %}
